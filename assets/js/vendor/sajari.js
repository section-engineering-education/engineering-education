var SajariSearch=function(u){"use strict";var e,o=function(r){var s={};return Object.keys(r.values).forEach(function(e){var t,n=void 0!==(t=r.values[e]).single?t.single:t.repeated instanceof Object?t.repeated.values:null;null!==n&&(s[e]=n)}),{values:s,token:{},score:parseFloat(r.score),indexScore:parseFloat(r.indexScore)}},p=function(e,s){void 0===e&&(e={}),void 0===s&&(s=[]);var n,t=(e.results||[]).map(function(e,t){var n=o(e),r=s[t];return void 0===r||(void 0!==r.click?n.token={click:"https://www.sajari.com/token/"+r.click.token}:void 0!==r.posNeg&&(n.token={pos:r.posNeg.pos,neg:r.posNeg.neg})),n});return{reads:parseInt(e.reads,10)||0,totalResults:parseInt(e.totalResults,10)||0,time:parseFloat(e.time)||0,aggregates:(n=e.aggregates,void 0===n&&(n={}),Object.keys(n).reduce(function(e,t){switch(t.split(".")[0]){case"bucket":e[t]=n[t].buckets.buckets;break;case"count":e[t]=n[t].count.counts;break;case"date":e[t]=n[t].date.dates;break;case"metric":e[t]=n[t].metric.value}return e},{})),results:t}};(e=u.TransportError||(u.TransportError={}))[e.None=0]="None",e[e.Connection=1]="Connection",e[e.ParseResponse=2]="ParseResponse";var t,n=function(){function c(e,t){this.client=e,this.name=t}return c.prototype.search=function(e,t,n){var r=t.next(e),s=r[0],o=r[1];if(o){var i=new Error("could not get next tracking data: "+o);return i.name="SessionError",void n(i)}var a=JSON.stringify({metadata:{collection:[this.client.collection],project:[this.client.project],"user-agent":["sdk-js-1.0.0"]},request:{tracking:s,values:e,pipeline:{name:this.name}}});!function(e,t,n){if(!navigator.onLine){var r=new Error("connection appears to be offline");return r.transportErrorCode=u.TransportError.Connection,n(r)}var s=new XMLHttpRequest;s.open("POST",e,!0),s.setRequestHeader("Accept","application/json"),s.setRequestHeader("Content-Type","application/json"),s.onreadystatechange=function(){if(s.readyState===XMLHttpRequest.DONE){var e;if(0===s.status)return(t=new Error("connection error")).transportErrorCode=u.TransportError.Connection,void n(t);try{e=JSON.parse(s.responseText)}catch(e){var t;return(t=new Error("error parsing response")).httpStatusCode=s.status,t.transportErrorCode=u.TransportError.ParseResponse,void n(t)}if(200!==s.status)return(t=new Error(e.message)).httpStatusCode=s.status,void n(t);n(null,e)}},s.send(t)}(this.client.endpoint+"/"+c.searchEndpoint,a,function(e,t){e?n(e):n(null,p(t.searchResponse,t.tokens),t.values)})},c.searchEndpoint="sajari.api.pipeline.v1.Query/Search",c}(),r=function(){function e(e,t,n){void 0===n&&(n=[]);var r=this;this.project=e,this.collection=t,this.endpoint="https://jsonapi.sajari.net",n.forEach(function(e){e(r)})}return e.prototype.pipeline=function(e){return new n(this,e)},e}();(t=u.TrackingType||(u.TrackingType={})).None="NONE",t.Click="CLICK",t.PosNeg="POS_NEG";var s=function(){function e(e,t){this.lastQuery="",this.queryLabel=e,this.session=t}return e.prototype.next=function(e){var t=e[this.queryLabel];if(void 0===t)return this.reset(),this.session.next(e);var n=this.lastQuery.substr(0,Math.min(t.length,3)),r=!(t.substr(0,n.length)===n),s=0<this.lastQuery.length&&0===t.length;return(r||s)&&this.reset(),this.lastQuery=t,this.session.next(e)},e.prototype.reset=function(){this.session.reset()},e}(),i=function(){function e(e,t,n){this.queryID="",this.sequence=0,this.trackingType=e,this.field=t,this.sessionData=n}return e.prototype.next=function(e){return""===this.queryID?(this.queryID=a(),this.sequence=0):this.sequence++,[{type:this.trackingType,query_id:this.queryID,sequence:this.sequence,field:this.field,data:this.sessionData},null]},e.prototype.reset=function(){this.queryID="",this.sequence=0},e}(),a=function(){for(var e="",t=0;t<16;t++)e+="abcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.floor(36*Math.random()));return e};return u.Client=r,u.withEndpoint=function(t){return function(e){e.endpoint=t}},u.InteractiveSession=s,u.DefaultSession=i,u}({});
//# sourceMappingURL=index.js.map
